<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Registration - MediBotxCareSync</title>
    
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/switch.css') }}">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
</head>
<body>

    <div id="starfield-container"></div>

    <div class="register-wrapper">
        <div class="register-box">
            <div class="register-header">
                <h2>Create Your Account</h2>
                <p>Please complete both steps to register.</p>
            </div>

            {% with messages = get_flashed_messages(with_categories=true) %}
              {% if messages %}
                {% for category, message in messages %}
                  <div class="flash-message {{ category }}">
                    <p>{{ message }}</p>
                  </div>
                {% endfor %}
              {% endif %}
            {% endwith %}

            <div class="step-progress" style="width: 50%; margin-bottom: 2rem;">
                <div class="step active" data-step="1"><span>1</span><p>Account</p></div>
                <div class="progress-bar"><div class="progress-bar-fill"></div></div>
                <div class="step" data-step="2"><span>2</span><p>Details</p></div>
            </div>

            <form id="user-register-form" method="POST" action="{{ url_for('auth.register_user') }}">
                <div class="form-step active" data-step="1">
                    <div class="form-group">
                        <label for="email">Email Address</label>
                        <input type="email" id="email" name="email" placeholder="you@example.com" required>
                    </div>
                    
                    <div class="password-wrapper">
                        <div class="form-group">
                            <label for="password">Password</label>
                            <input type="password" id="password" name="password" placeholder="Choose a strong password" required>
                        </div>
                        
                        <div id="password-feedback" class="password-rules">
                            <p id="length-check" class="invalid">At least 8 characters</p>
                            <p id="upper-check" class="invalid">An uppercase letter</p>
                            <p id="lower-check" class="invalid">A lowercase letter</p>
                            <p id="number-check" class="invalid">A number</p>
                            <p id="special-check" class="invalid">A special character</p>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="confirm_password">Confirm Password</label>
                        <input type="password" id="confirm_password" name="confirm_password" placeholder="Re-enter your password" required>
                        <p id="match-feedback" class="invalid" style="display: none;">Passwords do not match</p>
                    </div>
                </div>

                <div class="form-step" data-step="2">
                    <div class="form-group">
                        <label>Full Name</label>
                        <div class="form-row">
                            <input type="text" name="first_name" placeholder="First Name" required>
                            <input type="text" name="middle_name" placeholder="Middle Name">
                            <input type="text" name="last_name" placeholder="Last Name" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="age">Age</label>
                            <input type="number" id="age" name="age" placeholder="e.g., 25" required>
                        </div>
                        <div class="form-group">
                            <label for="gender">Gender</label>
                            <select id="gender" name="gender" required>
                                <option value="" disabled selected>Select Gender</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="phone">Phone Number</label>
                        <input type="tel" id="phone" name="phone" placeholder="+1 (555) 123-4567" required>
                    </div>
                    <div class="form-group">
                        <label for="address">Address</label>
                        <textarea id="address" name="address" rows="3" placeholder="Enter your full address" required></textarea>
                    </div>
                </div>

                <div class="step-nav-buttons">
                    <button type="button" class="nav-btn prev-btn" style="display: none;">Previous</button>
                    <button type="button" class="nav-btn next-btn">Next</button>
                    <button type="submit" class="nav-btn submit-btn" style="display: none;">Create Account</button>
                </div>
            </form>
             <div class="back-link">
                <p>Already have an account? <a href="{{ url_for('auth.login') }}">Login</a></p>
            </div>
        </div>
    </div>
    
    <script>
        // Starfield and Multi-step form logic
        document.addEventListener('DOMContentLoaded', () => {
            const starfield=document.getElementById('starfield-container');let stars=[];if(starfield){function generateStars(){const starCount=200;for(let i=0;i<starCount;i++){const star=document.createElement('div');const size=Math.floor(Math.random()*3)+1;star.classList.add('star',`s${size}`);star.style.top=`${Math.random()*100}%`;star.style.left=`${Math.random()*100}%`;star.style.animationDelay=`${Math.random()*3}s`;star.style.animationDuration=`${Math.random()*2+3}s`;star.dataset.parallaxRate=size;starfield.appendChild(star);stars.push(star)}}function handleMouseMove(e){const{clientX,clientY}=e;const xRatio=(clientX-window.innerWidth/2)/window.innerWidth;const yRatio=(clientY-window.innerHeight/2)/window.innerHeight;stars.forEach(star=>{const parallaxRate=star.dataset.parallaxRate;const x=xRatio*40*parallaxRate;const y=yRatio*40*parallaxRate;star.style.transform=`translate(${x}px, ${y}px)`})}function handleMouseLeave(){stars.forEach(star=>{star.style.transform=`translate(0, 0)`})}generateStars();document.body.addEventListener('mousemove',handleMouseMove);document.body.addEventListener('mouseleave',handleMouseLeave);}
            const steps=Array.from(document.querySelectorAll('.form-step'));const stepIndicators=Array.from(document.querySelectorAll('.step-progress .step'));const progressBarFills=Array.from(document.querySelectorAll('.progress-bar-fill'));const nextBtn=document.querySelector('.next-btn');const prevBtn=document.querySelector('.prev-btn');const submitBtn=document.querySelector('.submit-btn');let currentStep=1;
            function updateFormStep(){steps.forEach(step=>{step.classList.toggle('active',parseInt(step.dataset.step)===currentStep);});updateButtons();updateProgress();}
            function updateButtons(){prevBtn.style.display=currentStep>1?'inline-block':'none';nextBtn.style.display=currentStep<steps.length?'inline-block':'none';submitBtn.style.display=currentStep===steps.length?'inline-block':'none';}
            function updateProgress(){stepIndicators.forEach((step,index)=>{step.classList.toggle('active',index+1===currentStep);step.classList.toggle('completed',index<currentStep);});progressBarFills.forEach((fill,index)=>{fill.style.width=(index<currentStep-1)?'100%':'0%';});}
            nextBtn.addEventListener('click',()=>{if(currentStep<steps.length){currentStep++;updateFormStep();}});
            prevBtn.addEventListener('click',()=>{if(currentStep>1){currentStep--;updateFormStep();}});
            updateFormStep();

            // --- START: Updated Password Validation Script ---
            const passwordInput = document.getElementById('password');
            const confirmPasswordInput = document.getElementById('confirm_password');
            const passwordFeedback = document.getElementById('password-feedback');
            const matchFeedback = document.getElementById('match-feedback');
            
            const checks = {
                length: document.getElementById('length-check'),
                upper: document.getElementById('upper-check'),
                lower: document.getElementById('lower-check'),
                number: document.getElementById('number-check'),
                special: document.getElementById('special-check')
            };

            // Show the box on focus
            passwordInput.addEventListener('focus', () => {
                passwordFeedback.classList.add('visible');
            });

            // Hide the box on blur (when user clicks away)
            passwordInput.addEventListener('blur', () => {
                passwordFeedback.classList.remove('visible');
            });

            passwordInput.addEventListener('keyup', () => {
                const pass = passwordInput.value;
                checks.length.className = pass.length >= 8 ? 'valid' : 'invalid';
                checks.upper.className = /[A-Z]/.test(pass) ? 'valid' : 'invalid';
                checks.lower.className = /[a-z]/.test(pass) ? 'valid' : 'invalid';
                checks.number.className = /[0-9]/.test(pass) ? 'valid' : 'invalid';
                checks.special.className = /[!@#$%^&*(),.?":{}|<>]/.test(pass) ? 'valid' : 'invalid';
                
                checkPasswordsMatch();
            });
            
            confirmPasswordInput.addEventListener('keyup', checkPasswordsMatch);

            function checkPasswordsMatch() {
                if (confirmPasswordInput.value && passwordInput.value !== confirmPasswordInput.value) {
                    matchFeedback.style.display = 'block';
                } else {
                    matchFeedback.style.display = 'none';
                }
            }
            // --- END: Updated Password Validation Script ---
        });
    </script>
    <script src="{{ url_for('static', filename='js/starfield-toggle.js') }}"></script>
</body>
</html>